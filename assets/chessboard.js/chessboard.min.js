var COLUMNS="abcdefgh".split("");function validMove(e){if("string"!=typeof e)return!1;var n=e.split("-");return 2===n.length&&(!0===validSquare(n[0])&&!0===validSquare(n[1]))}function validSquare(e){return"string"==typeof e&&-1!==e.search(/^[a-h][1-8]$/)}function validPieceCode(e){return"string"==typeof e&&-1!==e.search(/^[bw][KQRNBP]$/)}function validFen(e){if("string"!=typeof e)return!1;var n=(e=e.replace(/ .+$/,"")).split("/");if(8!==n.length)return!1;for(var r=0;r<8;r++)if(""===n[r]||n[r].length>8||-1!==n[r].search(/[^kqrbnpKQRNBP1-8]/))return!1;return!0}function validPositionObject(e){if("object"!=typeof e)return!1;for(var n in e)if(!0===e.hasOwnProperty(n)&&(!0!==validSquare(n)||!0!==validPieceCode(e[n])))return!1;return!0}function fenToPieceCode(e){return e.toLowerCase()===e?"b"+e.toUpperCase():"w"+e.toUpperCase()}function pieceCodeToFen(e){var n=e.split("");return"w"===n[0]?n[1].toUpperCase():n[1].toLowerCase()}function fenToObj(e){if(!0!==validFen(e))return!1;for(var n=(e=e.replace(/ .+$/,"")).split("/"),r={},o=8,t=0;t<8;t++){for(var a=n[t].split(""),i=0,s=0;s<a.length;s++){if(-1!==a[s].search(/[1-8]/))i+=parseInt(a[s],10);else r[COLUMNS[i]+o]=fenToPieceCode(a[s]),i++}o--}return r}function objToFen(e){if(!0!==validPositionObject(e))return!1;for(var n="",r=8,o=0;o<8;o++){for(var t=0;t<8;t++){var a=COLUMNS[t]+r;!0===e.hasOwnProperty(a)?n+=pieceCodeToFen(e[a]):n+="1"}7!==o&&(n+="/"),r--}return n=(n=(n=(n=(n=(n=(n=n.replace(/11111111/g,"8")).replace(/1111111/g,"7")).replace(/111111/g,"6")).replace(/11111/g,"5")).replace(/1111/g,"4")).replace(/111/g,"3")).replace(/11/g,"2")}var ChessBoard=function(e,n){n=n||{};var r,o,t,a,i,s,p,c,f,d,u="1.7.0",h=fenToObj("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),l={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7"},v={},g=2,w="white",b={},y=!1,m={},P={};function O(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,(function(e){return(16*Math.random()|0).toString(16)}))}function S(e){return JSON.parse(JSON.stringify(e))}function x(e){var n=e.split(".");return{major:parseInt(n[0],10),minor:parseInt(n[1],10),patch:parseInt(n[2],10)}}function q(e,r,o){if(!0===n.hasOwnProperty("showErrors")&&!1!==n.showErrors){var t="ChessBoard Error "+e+": "+r;return"console"===n.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(t),void(arguments.length>=2&&console.log(o))):"alert"===n.showErrors?(o&&(t+="\n\n"+JSON.stringify(o)),void window.alert(t)):void("function"==typeof n.showErrors&&n.showErrors(e,r,o))}}function C(){if("string"==typeof e){if(""===e)return window.alert("ChessBoard Error 1001: The first argument to ChessBoard() cannot be an empty string.\n\nExiting..."),!1;var n=document.getElementById(e);if(!n)return window.alert('ChessBoard Error 1002: Element with id "'+e+'" does not exist in the DOM.\n\nExiting...'),!1;r=$(n)}else if(1!==(r=$(e)).length)return window.alert("ChessBoard Error 1003: The first argument to ChessBoard() must be an ID or a single DOM node.\n\nExiting..."),!1;return window.JSON&&"function"==typeof JSON.stringify&&"function"==typeof JSON.parse?(window.$,!(!$.fn||!$.fn.jquery||!0!=(o=$.fn.jquery,t=u,o=x(o),t=x(t),1e4*o.major*1e4+1e4*o.minor+o.patch>=1e4*t.major*1e4+1e4*t.minor+t.patch))||(window.alert("ChessBoard Error 1005: Unable to find a valid version of jQuery. Please include jQuery 1.7.0 or higher on the page.\n\nExiting..."),!1)):(window.alert("ChessBoard Error 1004: JSON does not exist. Please include a JSON polyfill.\n\nExiting..."),!1);var o,t}function T(e){return"fast"===e||"slow"===e||parseInt(e,10)+""==e+""&&e>=0}function E(e){return"function"==typeof n.pieceTheme?n.pieceTheme(e):"string"==typeof n.pieceTheme?n.pieceTheme.replace(/{piece}/g,e):(q(8272,"Unable to build image source for cfg.pieceTheme."),"")}function k(e,n,r){var o='<img src="'+E(e)+'" ';return r&&"string"==typeof r&&(o+='id="'+r+'" '),o+='alt="" class="'+l.piece+'" data-piece="'+e+'" style="width: '+s+"px;height: "+s+"px;",!0===n&&(o+="display:none;"),o+='" />'}function M(e){var n=["wK","wQ","wR","wB","wN","wP"];"black"===e&&(n=["bK","bQ","bR","bB","bN","bP"]);for(var r="",o=0;o<n.length;o++)r+=k(n[o],!1,m[n[o]]);return r}function B(e,r,o,t){var a=$("#"+P[e]),i=a.offset(),s=$("#"+P[r]),p=s.offset(),c=O();$("body").append(k(o,!0,c));var f=$("#"+c);f.css({display:"",position:"absolute",top:i.top,left:i.left}),a.find("."+l.piece).remove();var d={duration:n.moveSpeed,complete:function(){s.append(k(o)),f.remove(),"function"==typeof t&&t()}};f.animate(p,d)}function N(e,r,o){var t=$("#"+m[e]).offset(),a=$("#"+P[r]),i=a.offset(),s=O();$("body").append(k(e,!0,s));var p=$("#"+s);p.css({display:"",position:"absolute",left:t.left,top:t.top});var c={duration:n.moveSpeed,complete:function(){a.find("."+l.piece).remove(),a.append(k(e)),p.remove(),"function"==typeof o&&o()}};p.animate(i,c)}function j(e,n){e=e.split("");var r=COLUMNS.indexOf(e[0])+1,o=parseInt(e[1],10);n=n.split("");var t=COLUMNS.indexOf(n[0])+1,a=parseInt(n[1],10),i=Math.abs(r-t),s=Math.abs(o-a);return i>=s?i:s}function I(e,n,r){for(var o=function(e){for(var n=[],r=0;r<8;r++)for(var o=0;o<8;o++){var t=COLUMNS[r]+(o+1);e!==t&&n.push({square:t,distance:j(e,t)})}n.sort((function(e,n){return e.distance-n.distance}));var a=[];for(r=0;r<n.length;r++)a.push(n[r].square);return a}(r),t=0;t<o.length;t++){var a=o[t];if(!0===e.hasOwnProperty(a)&&e[a]===n)return a}return!1}function L(){for(var e in o.find("."+l.piece).remove(),b)!0===b.hasOwnProperty(e)&&$("#"+P[e]).append(k(b[e]))}function U(){o.html(function(e){"black"!==e&&(e="white");var r="",o=S(COLUMNS),t=8;"black"===e&&(o.reverse(),t=1);for(var a="white",i=0;i<8;i++){r+='<div class="'+l.row+'">';for(var p=0;p<8;p++){var c=o[p]+t;r+='<div class="'+l.square+" "+l[a]+" square-"+c+'" style="width: '+s+"px; height: "+s+'px" id="'+P[c]+'" data-square="'+c+'">',!0===n.showNotation&&(("white"===e&&1===t||"black"===e&&8===t)&&(r+='<div class="'+l.notation+" "+l.alpha+'">'+o[p]+"</div>"),0===p&&(r+='<div class="'+l.notation+" "+l.numeric+'">'+t+"</div>")),r+="</div>",a="white"===a?"black":"white"}r+='<div class="'+l.clearfix+'"></div></div>',a="white"===a?"black":"white","white"===e?t--:t++}return r}(w)),L(),!0===n.sparePieces&&("white"===w?(a.html(M("black")),i.html(M("white"))):(a.html(M("white")),i.html(M("black"))))}function D(e){var r=S(b),o=S(e);objToFen(r)!==objToFen(o)&&(!0===n.hasOwnProperty("onChange")&&"function"==typeof n.onChange&&n.onChange(r,o),b=e)}function F(e,n){for(var r in d)if(!0===d.hasOwnProperty(r)){var o=d[r];if(e>=o.left&&e<o.left+s&&n>=o.top&&n<o.top+s)return r}return"offboard"}function J(){o.find("."+l.square).removeClass(l.highlight1+" "+l.highlight2)}function Q(){J();var e=S(b);delete e[f],D(e),L(),t.fadeOut(n.trashSpeed),y=!1}function X(e,r,o,a){"function"==typeof n.onDragStart&&!1===n.onDragStart(e,r,S(b),w)||(y=!0,p=r,f=e,c="spare"===e?"offboard":e,function(){for(var e in d={},P)!0===P.hasOwnProperty(e)&&(d[e]=$("#"+P[e]).offset())}(),t.attr("src",E(r)).css({display:"",position:"absolute",left:o-s/2,top:a-s/2}),"spare"!==e&&$("#"+P[e]).addClass(l.highlight1).find("."+l.piece).css("display","none"))}function Y(e,r){t.css({left:e-s/2,top:r-s/2});var o=F(e,r);o!==c&&(!0===validSquare(c)&&$("#"+P[c]).removeClass(l.highlight2),!0===validSquare(o)&&$("#"+P[o]).addClass(l.highlight2),"function"==typeof n.onDragMove&&n.onDragMove(o,c,f,p,S(b),w),c=o)}function R(e){var r="drop";if("offboard"===e&&"snapback"===n.dropOffBoard&&(r="snapback"),"offboard"===e&&"trash"===n.dropOffBoard&&(r="trash"),!0===n.hasOwnProperty("onDrop")&&"function"==typeof n.onDrop){var o=S(b);"spare"===f&&!0===validSquare(e)&&(o[e]=p),!0===validSquare(f)&&"offboard"===e&&delete o[f],!0===validSquare(f)&&!0===validSquare(e)&&(delete o[f],o[e]=p);var a=S(b),i=n.onDrop(f,e,p,o,a,w);"snapback"!==i&&"trash"!==i||(r=i)}"snapback"===r?function(){if("spare"!==f){J();var e=$("#"+P[f]).offset(),r={duration:n.snapbackSpeed,complete:function(){L(),t.css("display","none"),!0===n.hasOwnProperty("onSnapbackEnd")&&"function"==typeof n.onSnapbackEnd&&n.onSnapbackEnd(p,f,S(b),w)}};t.animate(e,r),y=!1}else Q()}():"trash"===r?Q():"drop"===r&&function(e){J();var r=S(b);delete r[f],r[e]=p,D(r);var o=$("#"+P[e]).offset(),a={duration:n.snapSpeed,complete:function(){L(),t.css("display","none"),!0===n.hasOwnProperty("onSnapEnd")&&"function"==typeof n.onSnapEnd&&n.onSnapEnd(f,e,p)}};t.animate(o,a),y=!1}(e)}function K(e){e.preventDefault()}function z(e){if(!0===n.draggable){var r=$(this).attr("data-square");!0===validSquare(r)&&!0===b.hasOwnProperty(r)&&X(r,b[r],e.pageX,e.pageY)}}function A(e){if(!0===n.draggable){var r=$(this).attr("data-square");!0===validSquare(r)&&!0===b.hasOwnProperty(r)&&(e=e.originalEvent,X(r,b[r],e.changedTouches[0].pageX,e.changedTouches[0].pageY))}}function W(e){!0===n.sparePieces&&X("spare",$(this).attr("data-piece"),e.pageX,e.pageY)}function G(e){!0===n.sparePieces&&X("spare",$(this).attr("data-piece"),(e=e.originalEvent).changedTouches[0].pageX,e.changedTouches[0].pageY)}function H(e){!0===y&&Y(e.pageX,e.pageY)}function V(e){!0===y&&(e.preventDefault(),Y(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function Z(e){!0===y&&R(F(e.pageX,e.pageY))}function _(e){!0===y&&R(F(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function ee(e){if(!1===y&&!0===n.hasOwnProperty("onMouseoverSquare")&&"function"==typeof n.onMouseoverSquare){var r=$(e.currentTarget).attr("data-square");if(!0===validSquare(r)){var o=!1;!0===b.hasOwnProperty(r)&&(o=b[r]),n.onMouseoverSquare(r,o,S(b),w)}}}function ne(e){if(!1===y&&!0===n.hasOwnProperty("onMouseoutSquare")&&"function"==typeof n.onMouseoutSquare){var r=$(e.currentTarget).attr("data-square");if(!0===validSquare(r)){var o=!1;!0===b.hasOwnProperty(r)&&(o=b[r]),n.onMouseoutSquare(r,o,S(b),w)}}}function re(){$("body").on("mousedown mousemove","."+l.piece,K),o.on("mousedown","."+l.square,z),r.on("mousedown","."+l.sparePieces+" ."+l.piece,W),o.on("mouseenter","."+l.square,ee).on("mouseleave","."+l.square,ne),!0===(navigator&&navigator.userAgent&&-1!==navigator.userAgent.search(/MSIE/))?(document.ondragstart=function(){return!1},$("body").on("mousemove",H).on("mouseup",Z)):$(window).on("mousemove",H).on("mouseup",Z),"ontouchstart"in document.documentElement==!0&&(o.on("touchstart","."+l.square,A),r.on("touchstart","."+l.sparePieces+" ."+l.piece,G),$(window).on("touchmove",V).on("touchend",_))}function oe(){var e;!function(){for(var e=0;e<COLUMNS.length;e++)for(var n=1;n<=8;n++){var r=COLUMNS[e]+n;P[r]=r+"-"+O()}var o="KQRBNP".split("");for(e=0;e<o.length;e++){var t="w"+o[e],a="b"+o[e];m[t]=t+"-"+O(),m[a]=a+"-"+O()}}(),r.html((e='<div class="'+l.chessboard+'">',!0===n.sparePieces&&(e+='<div class="'+l.sparePieces+" "+l.sparePiecesTop+'"></div>'),e+='<div class="'+l.board+'"></div>',!0===n.sparePieces&&(e+='<div class="'+l.sparePieces+" "+l.sparePiecesBottom+'"></div>'),e+"</div>")),o=r.find("."+l.board),!0===n.sparePieces&&(a=r.find("."+l.sparePiecesTop),i=r.find("."+l.sparePiecesBottom));var s=O();$("body").append(k("wP",!0,s)),t=$("#"+s),g=parseInt(o.css("borderLeftWidth"),10),v.resize()}return v.clear=function(e){v.position({},e)},v.destroy=function(){r.html(""),t.remove(),r.unbind()},v.fen=function(){return v.position("fen")},v.flip=function(){return v.orientation("flip")},v.move=function(){if(0!==arguments.length){for(var e=!0,n={},r=0;r<arguments.length;r++)if(!1!==arguments[r])if(!0===validMove(arguments[r])){var o=arguments[r].split("-");n[o[0]]=o[1]}else q(2826,"Invalid move passed to the move method.",arguments[r]);else e=!1;var t=function(e,n){for(var r in e=S(e),n)if(!0===n.hasOwnProperty(r)&&!0===e.hasOwnProperty(r)){var o=e[r];delete e[r],e[n[r]]=o}return e}(b,n);return v.position(t,e),t}},v.orientation=function(e){return 0===arguments.length?w:"white"===e||"black"===e?(w=e,U(),w):"flip"===e?(w="white"===w?"black":"white",U(),w):void q(5482,"Invalid value passed to the orientation method.",e)},v.position=function(e,r){return 0===arguments.length?S(b):"string"==typeof e&&"fen"===e.toLowerCase()?objToFen(b):(!1!==r&&(r=!0),"string"==typeof e&&"start"===e.toLowerCase()&&(e=S(h)),!0===validFen(e)&&(e=fenToObj(e)),void(!0===validPositionObject(e)?!0===r?(!function(e,r,o){if(0!==e.length){0;for(var t=0,a=0;a<e.length;a++)"clear"===e[a].type&&$("#"+P[e[a].square]+" ."+l.piece).fadeOut(n.trashSpeed,i),"add"===e[a].type&&!0!==n.sparePieces&&$("#"+P[e[a].square]).append(k(e[a].piece,!0)).find("."+l.piece).fadeIn(n.appearSpeed,i),"add"===e[a].type&&!0===n.sparePieces&&N(e[a].piece,e[a].square,i),"move"===e[a].type&&B(e[a].source,e[a].destination,e[a].piece,i)}function i(){++t===e.length&&(L(),!0===n.hasOwnProperty("onMoveEnd")&&"function"==typeof n.onMoveEnd&&n.onMoveEnd(S(r),S(o)))}}(function(e,n){e=S(e),n=S(n);var r=[],o={};for(var t in n)!0===n.hasOwnProperty(t)&&!0===e.hasOwnProperty(t)&&e[t]===n[t]&&(delete e[t],delete n[t]);for(var t in n)if(!0===n.hasOwnProperty(t)){var a=I(e,n[t],t);!1!==a&&(r.push({type:"move",source:a,destination:t,piece:n[t]}),delete e[a],delete n[t],o[t]=!0)}for(var t in n)!0===n.hasOwnProperty(t)&&(r.push({type:"add",square:t,piece:n[t]}),delete n[t]);for(var t in e)!0===e.hasOwnProperty(t)&&!0!==o.hasOwnProperty(t)&&(r.push({type:"clear",square:t,piece:e[t]}),delete e[t]);return r}(b,e),b,e),D(e)):(D(e),L()):q(6482,"Invalid value passed to the position method.",e)))},v.resize=function(){s=function(){var e=parseInt(r.width(),10);if(!e||e<=0)return 0;for(var n=e-1;n%8!=0&&n>0;)n--;return n/8}(),o.css("width",8*s+"px"),t.css({height:s,width:s}),!0===n.sparePieces&&r.find("."+l.sparePieces).css("paddingLeft",s+g+"px"),U()},v.start=function(e){v.position("start",e)},!0===C()&&1==("string"!=typeof n&&!0!==validPositionObject(n)||(n={position:n}),"black"!==n.orientation&&(n.orientation="white"),w=n.orientation,!1!==n.showNotation&&(n.showNotation=!0),!0!==n.draggable&&(n.draggable=!1),"trash"!==n.dropOffBoard&&(n.dropOffBoard="snapback"),!0!==n.sparePieces&&(n.sparePieces=!1),!0===n.sparePieces&&(n.draggable=!0),(!0!==n.hasOwnProperty("pieceTheme")||"string"!=typeof n.pieceTheme&&"function"!=typeof n.pieceTheme)&&(n.pieceTheme="img/chesspieces/wikipedia/{piece}.png"),!0===n.hasOwnProperty("appearSpeed")&&!0===T(n.appearSpeed)||(n.appearSpeed=200),!0===n.hasOwnProperty("moveSpeed")&&!0===T(n.moveSpeed)||(n.moveSpeed=200),!0===n.hasOwnProperty("snapbackSpeed")&&!0===T(n.snapbackSpeed)||(n.snapbackSpeed=50),!0===n.hasOwnProperty("snapSpeed")&&!0===T(n.snapSpeed)||(n.snapSpeed=25),!0===n.hasOwnProperty("trashSpeed")&&!0===T(n.trashSpeed)||(n.trashSpeed=100),!0===n.hasOwnProperty("position")&&("start"===n.position?b=S(h):!0===validFen(n.position)?b=fenToObj(n.position):!0===validPositionObject(n.position)?b=S(n.position):q(7263,"Invalid value passed to config.position.",n.position)),!0)&&(oe(),re()),v};ChessBoard.fenToObj=fenToObj,ChessBoard.objToFen=objToFen,module.exports=ChessBoard;
//# sourceMappingURL=/sm/195d99609b5564bc223eb8794a4ca4ed111d958721178d9bde876ae5d85ea107.map