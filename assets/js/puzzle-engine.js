!function(){"use strict";var e="undefined"!=typeof window?window:globalThis;if("function"!=typeof e.Chess||"function"!=typeof e.Chessboard)return;document.addEventListener("DOMContentLoaded",function(){var e=[].slice.call(document.querySelectorAll("puzzle")),t=!1;e.forEach(function(e){if(e.__jcInit)return;e.__jcInit=!0;var n=(e.innerHTML||"").replace(/[â™”â™•â™–â™—â™˜â™™â™šâ™›â™œâ™â™â™Ÿ]/g,"").trim(),r=document.createElement("div");r.className="jc-puzzle-wrapper",e.replaceWith(r);var o=n.match(/FEN:\s*([^\n<]+)/i),a=n.match(/Moves:\s*([^\n<]+)/i),i=n.match(/PGN:\s*(https?:\/\/[^\s<]+)/i),s=!i&&n.match(/PGN:\s*(1\.[\s\S]+)/i);if(i&&!o){if(t)return void(r.textContent="âš ï¸ Only one remote PGN pack allowed per page.");t=!0,initRemote(r,i[1].trim())}else o&&s?renderLocal(r,o[1].trim(),parsePGN(s[1])):o&&a?renderLocal(r,o[1].trim(),a[1].trim().split(/\s+/)):r.textContent="âŒ Invalid <puzzle> block."})});function parsePGN(e){return e.replace(/\[[^\]]*]/g," ").replace(/\{[^}]*}/g," ").replace(/\([^)]*\)/g," ").replace(/\b\d+\.\.\./g," ").replace(/\b\d+\.(?:\.\.)?/g," ").replace(/\b(1-0|0-1|1\/2-1\/2|\*)\b/g," ").replace(/\s+/g," ").trim().split(" ").filter(Boolean)}function normSAN(e){return(e||"").replace(/[+#?!]/g,"")}function renderLocal(e,t,n){var r=new Chess(t),o=0,a=!1,i=document.createElement("div");i.className="jc-board";var s=document.createElement("div");s.className="jc-status-row";var l=document.createElement("span");l.className="jc-turn";var c=document.createElement("span");c.className="jc-feedback",s.append(l,c),e.append(i,s);var d=Chessboard(i,{draggable:!0,position:t,pieceTheme:"https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png",onDrop:function(e,t){return play(e,t)||"snapback"}});function update(){l.textContent=a?"":("w"===r.turn()?"âš White to move":"âš‘ Black to move")}function play(e,t){if(a)return!1;var i=n[o],s=r.move({from:e,to:t,promotion:"q"});return s?normSAN(s.san)!==normSAN(i)?(r.undo(),c.textContent="Wrong move âŒ",update(),!1):(o++,c.textContent="Correct move âœ…",autoOpponent(),!0):!1}function autoOpponent(){if(o>=n.length)return a=!0,c.textContent="Puzzle solved ğŸ†",void update();var e="w"===r.turn();if(e&&(0===o%2)||!e&&(1===o%2))return update();var t=n[o],i=r.move(t,{sloppy:!0});i?(o++,d.position(r.fen(),!0),update()):(a=!0,c.textContent="Puzzle solved ğŸ†",update())}update()}function initRemote(e,t){var n=20,r=document.createElement("div");r.className="jc-board";var o=document.createElement("div");o.className="jc-status-row";var a=document.createElement("span");a.className="jc-turn";var i=document.createElement("span");i.className="jc-feedback";var s=document.createElement("span");s.className="jc-controls";var l=document.createElement("button");l.textContent="â†¶";var c=document.createElement("button");c.textContent="â†·",s.append(l,c),o.append(a,i,s),e.append(r,o),i.textContent="Loading puzzle packâ€¦";fetch(t).then(function(e){return e.text()}).then(function(e){var t=e.split(/\[Event\b/).slice(1).map(function(e){return"[Event"+e}),o=[],s=0,l=0,c,d,u,p=!1,f=new Chessboard(r,{draggable:!0,pieceTheme:"https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png",onDrop:function(e,t){return play(e,t)||"snapback"}});function parse(){for(var e=Math.min(s+n,t.length);s<e;s++){var r=t[s].match(/\[FEN\s+"([^"]+)"/);if(r){var a=parsePGN(t[s]);a.length&&o.push({fen:r[1],moves:a})}}}function load(e){o[e]||(parse(),o[e])&&(l=e,c=new Chess(o[e].fen),d=o[e].moves,u=0,p=!1,f.position(c.fen()),i.textContent="",update())}function update(){a.textContent=p?"":("w"===c.turn()?"âš White to move":"âš‘ Black to move")}function play(e,t){if(p)return!1;var r=d[u],o=c.move({from:e,to:t,promotion:"q"});return o?normSAN(o.san)!==normSAN(r)?(c.undo(),i.textContent="Wrong move âŒ",update(),!1):(u++,i.textContent="Correct move âœ…",autoOpponent(),!0):!1}function autoOpponent(){if(u>=d.length)return p=!0,i.textContent="Puzzle solved ğŸ†",void update();var e="w"===c.turn();if(e&&(0===u%2)||!e&&(1===u%2))return update();var t=d[u],n=c.move(t,{sloppy:!0});n?(u++,f.position(c.fen(),!0),update()):(p=!0,i.textContent="Puzzle solved ğŸ†",update())}l.onclick=function(){load(l-1)},c.onclick=function(){load(l+1)},parse(),load(0)}).catch(function(){i.textContent="âŒ Failed to load PGN."})}}();